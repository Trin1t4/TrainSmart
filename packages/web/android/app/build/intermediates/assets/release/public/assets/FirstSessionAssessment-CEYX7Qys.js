import{j as e,r as u,c as C,G as z,C as T,V as I,ab as q,k,Y as P,a as E,P as _}from"./vendor-ui-B5xs3EUI.js";import{a as b}from"./vendor-react-DLKD8xKB.js";import{s as A}from"./index-CsHuaFST.js";import"./vendor-supabase-DF1H9KNm.js";const v=[{id:"push",pattern:"horizontal_push",title:"Test Push",gymExercise:"Chest Press (o Push-up)",homeExercise:"Push-up",instructions:["Posizionati in posizione di partenza","Esegui il maggior numero di ripetizioni possibili","Mantieni la tecnica corretta fino alla fine","Fermati quando non riesci piÃ¹ a completare una rep pulita"],targetReps:{beginner:"< 10 reps",intermediate:"10-20 reps",advanced:"> 20 reps"},icon:"ðŸ’ª"},{id:"pull",pattern:"horizontal_pull",title:"Test Pull",gymExercise:"Lat Machine (o Australian Row)",homeExercise:"Australian Row (sotto un tavolo)",instructions:["Imposta un peso moderato (lat) o trova una posizione inclinata (row)","Esegui trazioni portando il petto verso la barra/tavolo","Conta quante ripetizioni riesci a fare con tecnica corretta","Il petto deve toccare (o avvicinarsi molto) alla barra"],targetReps:{beginner:"< 8 reps",intermediate:"8-15 reps",advanced:"> 15 reps"},icon:"ðŸ”™"},{id:"squat",pattern:"lower_push",title:"Test Squat",gymExercise:"Goblet Squat (o Bodyweight)",homeExercise:"Bodyweight Squat",instructions:["Piedi larghezza spalle, punte leggermente in fuori","Scendi fino a quando le cosce sono parallele al pavimento","Risali completamente estendendo le ginocchia","Conta le ripetizioni fino a quando la tecnica si deteriora"],targetReps:{beginner:"< 15 reps",intermediate:"15-30 reps",advanced:"> 30 reps"},icon:"ðŸ¦µ"}];function w(t,n){const m={push:{intermediate:10,advanced:20},pull:{intermediate:8,advanced:15},squat:{intermediate:15,advanced:30}}[t];return n<m.intermediate?{level:"beginner",baseline:S(t,"beginner"),difficulty:3}:n<m.advanced?{level:"intermediate",baseline:S(t,"intermediate"),difficulty:5}:{level:"advanced",baseline:S(t,"advanced"),difficulty:7}}function S(t,n){return{push:{beginner:"Incline Push-up",intermediate:"Push-up",advanced:"Diamond Push-up"},pull:{beginner:"High Australian Row",intermediate:"Australian Row",advanced:"Low Australian Row"},squat:{beginner:"Assisted Squat",intermediate:"Bodyweight Squat",advanced:"Pistol Squat Progression"}}[t][n]}function B({test:t,location:n,result:o,onStart:m,isCompleted:c}){const x=n==="gym"?t.gymExercise:t.homeExercise,i=o?w(t.id,o.reps):null;return e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`bg-slate-800/50 rounded-xl p-5 border-2 transition-all ${c?"border-emerald-500/50":"border-slate-700 hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white text-lg",children:t.title}),e.jsx("p",{className:"text-slate-400 text-sm",children:x})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 bg-emerald-500/20 px-3 py-1.5 rounded-full",children:[e.jsx(E,{className:"w-4 h-4 text-emerald-400"}),e.jsxs("span",{className:"text-emerald-300 font-semibold",children:[o==null?void 0:o.reps," reps"]})]})]}),i&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${i.level==="beginner"?"bg-blue-500/10 border border-blue-500/30":i.level==="intermediate"?"bg-yellow-500/10 border border-yellow-500/30":"bg-emerald-500/10 border border-emerald-500/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`text-sm font-semibold ${i.level==="beginner"?"text-blue-300":i.level==="intermediate"?"text-yellow-300":"text-emerald-300"}`,children:["Livello: ",i.level.charAt(0).toUpperCase()+i.level.slice(1)]}),e.jsxs("span",{className:"text-xs text-slate-400",children:["Baseline: ",i.baseline]})]})}),!c&&e.jsxs("div",{className:"mb-4 grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-blue-500/10 p-2 rounded text-center",children:[e.jsx("div",{className:"text-blue-300 font-semibold",children:"Beginner"}),e.jsx("div",{className:"text-blue-400/70",children:t.targetReps.beginner})]}),e.jsxs("div",{className:"bg-yellow-500/10 p-2 rounded text-center",children:[e.jsx("div",{className:"text-yellow-300 font-semibold",children:"Intermediate"}),e.jsx("div",{className:"text-yellow-400/70",children:t.targetReps.intermediate})]}),e.jsxs("div",{className:"bg-emerald-500/10 p-2 rounded text-center",children:[e.jsx("div",{className:"text-emerald-300 font-semibold",children:"Advanced"}),e.jsx("div",{className:"text-emerald-400/70",children:t.targetReps.advanced})]})]}),!c&&e.jsxs("button",{onClick:m,className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Inizia Test"]})]})}function D({test:t,location:n,onComplete:o,onBack:m}){const[c,x]=b.useState("instructions"),[i,l]=b.useState(""),[j,N]=b.useState(7),g=n==="gym"?t.gymExercise:t.homeExercise,d=()=>{const a=parseInt(i);isNaN(a)||a<0||o({reps:a,rpe:j})};return e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-slate-800/50 backdrop-blur-lg rounded-2xl p-6 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:t.title}),e.jsx("p",{className:"text-slate-400",children:g})]})]}),e.jsx("button",{onClick:m,className:"text-slate-400 hover:text-white transition",children:"âœ•"})]}),e.jsx(I,{mode:"wait",children:c==="instructions"?e.jsxs(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsxs("div",{className:"bg-slate-700/50 rounded-xl p-8 mb-6 flex flex-col items-center justify-center",children:[e.jsx(q,{className:"w-12 h-12 text-slate-500 mb-2"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Video dimostrativo"}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:g})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-400"}),"Come eseguire il test"]}),e.jsx("ol",{className:"space-y-2",children:t.instructions.map((a,y)=>e.jsxs("li",{className:"flex items-start gap-3 text-slate-300",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-500/20 text-blue-400 rounded-full flex items-center justify-center text-sm font-semibold flex-shrink-0",children:y+1}),a]},y))})]}),e.jsxs("button",{onClick:()=>x("input"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-600 hover:to-blue-700 transition flex items-center justify-center gap-2",children:["Ho capito, inizia",e.jsx(T,{className:"w-5 h-5"})]})]},"instructions"):e.jsxs(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 mb-6",children:e.jsxs("p",{className:"text-blue-200 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Esegui il test e inserisci il numero di ripetizioni completate con tecnica corretta."]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Quante ripetizioni hai fatto?"}),e.jsx("input",{type:"number",min:"0",max:"100",value:i,onChange:a=>l(a.target.value),placeholder:"0",className:"w-full bg-slate-700 border border-slate-600 text-white rounded-xl px-4 py-4 text-3xl font-bold text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition",autoFocus:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Quanto Ã¨ stato difficile? (1 = facile, 10 = massimo)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5,6,7,8,9,10].map(a=>e.jsx("button",{type:"button",onClick:()=>N(a),className:`flex-1 py-2 rounded-lg text-sm font-semibold transition ${j===a?a<=3?"bg-green-500 text-white":a<=6?"bg-yellow-500 text-white":a<=8?"bg-orange-500 text-white":"bg-red-500 text-white":"bg-slate-700 text-slate-400 hover:bg-slate-600"}`,children:a},a))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>x("instructions"),className:"flex-1 bg-slate-700 text-slate-300 py-4 rounded-xl font-semibold hover:bg-slate-600 transition flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Indietro"]}),e.jsxs("button",{onClick:d,disabled:!i||parseInt(i)<0,className:"flex-1 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white py-4 rounded-xl font-bold hover:from-emerald-600 hover:to-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:["Conferma",e.jsx(E,{className:"w-5 h-5"})]})]})]},"input")})]})}function V({userId:t,location:n,currentBaselines:o,onComplete:m,onSkip:c}){const[x,i]=b.useState(null),[l,j]=b.useState({}),[N,g]=b.useState(!1),d=Object.keys(l).filter(s=>s!=="completedAt").length,a=d===v.length,y=(s,p)=>{const h=`${s}Test`;j(r=>({...r,[h]:p})),i(null)},R=async()=>{g(!0);try{const s={...o||{}};if(l.pushTest){const{level:h,baseline:r,difficulty:f}=w("push",l.pushTest.reps);s.horizontal_push={variantId:r.toLowerCase().replace(/\s+/g,"_"),variantName:r,difficulty:f,reps:l.pushTest.reps,testDate:new Date().toISOString()}}if(l.pullTest){const{level:h,baseline:r,difficulty:f}=w("pull",l.pullTest.reps);s.horizontal_pull={variantId:r.toLowerCase().replace(/\s+/g,"_"),variantName:r,difficulty:f,reps:l.pullTest.reps,testDate:new Date().toISOString()}}if(l.squatTest){const{level:h,baseline:r,difficulty:f}=w("squat",l.squatTest.reps);s.lower_push={variantId:r.toLowerCase().replace(/\s+/g,"_"),variantName:r,difficulty:f,reps:l.squatTest.reps,testDate:new Date().toISOString()}}const{error:p}=await A.from("user_profiles").update({baselines:s,first_session_assessment:{...l,completedAt:new Date().toISOString()},updated_at:new Date().toISOString()}).eq("user_id",t);if(p)throw p;console.log("[FIRST_SESSION] Assessment saved",s),m(s)}catch(s){console.error("[FIRST_SESSION] Error saving:",s),alert("Errore durante il salvataggio. Riprova.")}finally{g(!1)}};return x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-8 px-4",children:e.jsx("div",{className:"max-w-lg mx-auto",children:e.jsx(D,{test:x,location:n,onComplete:s=>y(x.id,s),onBack:()=>i(null)})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(u.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(C,{className:"w-8 h-8 text-blue-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Test di Valutazione"}),e.jsx("p",{className:"text-slate-400",children:"Prima di iniziare, testiamo il tuo livello reale"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Completati"}),e.jsxs("span",{className:"text-sm font-semibold text-white",children:[d," / ",v.length]})]}),e.jsx("div",{className:"h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx(u.div,{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-600",initial:{width:0},animate:{width:`${d/v.length*100}%`},transition:{duration:.3}})})]}),e.jsx("div",{className:"space-y-4 mb-8",children:v.map((s,p)=>{const h=`${s.id}Test`,r=l[h];return e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:p*.1},children:e.jsx(B,{test:s,location:n,result:r,onStart:()=>i(s),isCompleted:!!r})},s.id)})}),e.jsxs("div",{className:"space-y-4",children:[a&&e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4 flex items-center gap-3",children:[e.jsx(z,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-300 font-semibold",children:"Tutti i test completati!"}),e.jsx("p",{className:"text-emerald-400/70 text-sm",children:"Il programma verrÃ  calibrato sui tuoi risultati reali"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[c&&e.jsx("button",{onClick:c,className:"flex-1 bg-slate-700 text-slate-300 py-4 rounded-xl font-semibold hover:bg-slate-600 transition",children:"Salta per ora"}),e.jsx("button",{onClick:R,disabled:d===0||N,className:"flex-1 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-emerald-500/20 hover:from-emerald-600 hover:to-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Salvataggio..."]}):e.jsxs(e.Fragment,{children:[a?"Salva e genera programma":`Continua con ${d} test`,e.jsx(T,{className:"w-5 h-5"})]})})]}),d>0&&d<v.length&&e.jsx("p",{className:"text-center text-slate-500 text-sm",children:"Puoi completare i test mancanti in seguito"})]})]})})}export{V as default};
