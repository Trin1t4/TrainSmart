import{j as e,r as o,R,V as F,T as C,a6 as T}from"./vendor-ui-B5xs3EUI.js";import{u as L,a as x}from"./vendor-react-DLKD8xKB.js";import{a2 as $,af as I,s as E}from"./index-CsHuaFST.js";import{a8 as y,ag as O,a9 as j,aa as f,ab as N,ac as v,ad as U,af as w,ae as _}from"./LineChart-BlBDR0Gt.js";import{B as D}from"./BarChart-yvnJK2nz.js";import"./vendor-supabase-DF1H9KNm.js";import"./clsx-B-dksMZM.js";function Q(){const d=L(),[c,i]=x.useState(!0),[g,b]=x.useState(!1),[t,P]=x.useState(null),[k,u]=x.useState(null),[n,m]=x.useState({isOpen:!1,userId:"",userEmail:"",isResetting:!1});x.useEffect(()=>{A()},[]);async function S(r){m(a=>({...a,isResetting:!0}));try{const{error:a}=await E.from("training_programs").delete().eq("user_id",r);if(a)throw console.error("[AdminDashboard] Error deleting programs:",a),a;const{error:s}=await E.from("user_profiles").update({onboarding_completed:!1,updated_at:new Date().toISOString()}).eq("user_id",r);s&&console.error("[AdminDashboard] Error updating profile:",s),console.log(`[AdminDashboard] âœ… Program reset for user ${r}`),m({isOpen:!1,userId:"",userEmail:"",isResetting:!1}),await A()}catch(a){console.error("[AdminDashboard] Reset error:",a),alert("Errore durante il reset: "+(a.message||"Errore sconosciuto")),m(s=>({...s,isResetting:!1}))}}async function A(){try{i(!0),u(null);const{data:r,error:a}=await $();if(a)throw new Error("Errore verifica admin: "+a.message);if(!r){u("Accesso negato: Non hai i permessi di amministratore"),i(!1),setTimeout(()=>d("/dashboard"),3e3);return}b(!0);const{data:s,error:l}=await I();if(l)throw new Error("Errore caricamento dati: "+l.message);P(s),i(!1)}catch(r){console.error("[AdminDashboard] Error:",r),u(r.message||"Errore caricamento dashboard"),i(!1)}}return c?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Caricamento dashboard admin..."})]})}):k||!g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-500 rounded-lg p-8 max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-4",children:"â›” Accesso Negato"}),e.jsx("p",{className:"text-gray-300",children:k}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"Redirect to dashboard..."})]})}):t?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white",children:[e.jsx("header",{className:"bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-10",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ðŸŽ›ï¸ Admin Dashboard"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"TrainSmart Analytics & Monitoring"})]}),e.jsx("button",{onClick:()=>d("/dashboard"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition",children:"â† Torna alla Dashboard"})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(h,{title:"Totale Utenti",value:t.totalUsers,icon:"ðŸ‘¥",color:"blue"}),e.jsx(h,{title:"Utenti Attivi",value:t.activeUsers,subtitle:`${Math.round(t.activeUsers/t.totalUsers*100)}% del totale`,icon:"âœ…",color:"green"}),e.jsx(h,{title:"Programmi Creati",value:t.totalPrograms,icon:"ðŸ“‹",color:"purple"}),e.jsx(h,{title:"Workout Loggati",value:t.totalWorkouts,icon:"ðŸ’ª",color:"orange"})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ”„ Conversion Funnel"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(p,{title:"Registration â†’ Onboarding",rate:t.conversionRates.registrationToOnboarding}),e.jsx(p,{title:"Onboarding â†’ Screening",rate:t.conversionRates.onboardingToScreening}),e.jsx(p,{title:"Screening â†’ Program",rate:t.conversionRates.screeningToProgram}),e.jsx(p,{title:"Program â†’ Workout",rate:t.conversionRates.programToWorkout})]})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ“ˆ Registrazioni & Programmi (30 giorni)"}),e.jsx(y,{width:"100%",height:300,children:e.jsxs(O,{data:t.businessMetrics,children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(f,{dataKey:"date_id",stroke:"#9CA3AF",tickFormatter:r=>new Date(r).toLocaleDateString("it-IT",{month:"short",day:"numeric"})}),e.jsx(N,{stroke:"#9CA3AF"}),e.jsx(v,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151"},labelFormatter:r=>new Date(r).toLocaleDateString("it-IT")}),e.jsx(U,{}),e.jsx(w,{type:"monotone",dataKey:"new_registrations",stroke:"#3B82F6",strokeWidth:2,name:"Registrazioni"}),e.jsx(w,{type:"monotone",dataKey:"program_creations",stroke:"#10B981",strokeWidth:2,name:"Programmi"}),e.jsx(w,{type:"monotone",dataKey:"workouts_logged",stroke:"#F59E0B",strokeWidth:2,name:"Workout"})]})})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ“… Frequenza Allenamento Settimanale"}),t.programPopularity.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(D,{data:Object.entries(t.programPopularity.reduce((r,a)=>{const s=a.split.match(/(\d+)x/),l=s?`${s[1]}x/settimana`:a.split;return r[l]=(r[l]||0)+a.total_programs,r},{})).map(([r,a])=>({frequency:r,count:a})).sort((r,a)=>{const s=parseInt(r.frequency),l=parseInt(a.frequency);return s-l}),children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(f,{dataKey:"frequency",stroke:"#9CA3AF"}),e.jsx(N,{stroke:"#9CA3AF"}),e.jsx(v,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151"},formatter:r=>[`${r} utenti`,"Totale"]}),e.jsx(_,{dataKey:"count",fill:"#F59E0B",name:"Utenti"})]})}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun dato disponibile"})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ† Programmi PiÃ¹ Popolari (per Goal + Location)"}),t.programPopularity.length>0?e.jsx(y,{width:"100%",height:300,children:e.jsxs(D,{data:t.programPopularity.slice(0,8).map(r=>({...r,programLabel:`${r.goal} - ${r.location}`})),children:[e.jsx(j,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(f,{dataKey:"programLabel",stroke:"#9CA3AF",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:11}),e.jsx(N,{stroke:"#9CA3AF"}),e.jsx(v,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151"},formatter:(r,a,s)=>a==="Programmi"?[`${r} programmi`,`${s.payload.level} - ${s.payload.split}`]:r}),e.jsx(_,{dataKey:"total_programs",fill:"#8B5CF6",name:"Programmi"})]})}):e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun dato disponibile"})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"ðŸ‘¥ Ultimi Utenti Registrati"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-400 border-b border-gray-700",children:[e.jsx("th",{className:"pb-2",children:"Email"}),e.jsx("th",{className:"pb-2",children:"Registrato"}),e.jsx("th",{className:"pb-2",children:"Programmi"}),e.jsx("th",{className:"pb-2",children:"Workout"}),e.jsx("th",{className:"pb-2",children:"Stato"}),e.jsx("th",{className:"pb-2",children:"Azioni"})]})}),e.jsx("tbody",{children:t.recentUsers.map((r,a)=>e.jsxs("tr",{className:"border-b border-gray-700/50",children:[e.jsx("td",{className:"py-3 text-sm",children:r.email}),e.jsx("td",{className:"py-3 text-sm text-gray-400",children:new Date(r.created_at).toLocaleDateString("it-IT")}),e.jsx("td",{className:"py-3 text-sm",children:r.total_programs_created}),e.jsx("td",{className:"py-3 text-sm",children:r.total_workouts_logged}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${r.is_active?"bg-green-900/30 text-green-400":"bg-gray-700/30 text-gray-400"}`,children:r.is_active?"Attivo":"Inattivo"})}),e.jsx("td",{className:"py-3",children:e.jsxs("button",{onClick:()=>m({isOpen:!0,userId:r.user_id,userEmail:r.email,isResetting:!1}),disabled:r.total_programs_created===0,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition ${r.total_programs_created>0?"bg-red-900/30 text-red-400 hover:bg-red-900/50 border border-red-800":"bg-gray-700/30 text-gray-500 cursor-not-allowed"}`,title:r.total_programs_created===0?"Nessun programma da resettare":"Reset programma",children:[e.jsx(R,{className:"w-3 h-3"}),"Reset"]})})]},r.user_id))})]})})]})]}),e.jsx(F,{children:n.isOpen&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>!n.isResetting&&m({isOpen:!1,userId:"",userEmail:"",isResetting:!1}),children:e.jsxs(o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-gray-800 rounded-xl p-6 max-w-md w-full border border-gray-700 shadow-xl",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Reset Programma"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Questa azione Ã¨ irreversibile"})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-gray-300 text-sm",children:["Stai per eliminare ",e.jsx("strong",{children:"tutti i programmi"})," dell'utente:"]}),e.jsx("p",{className:"text-white font-mono text-sm mt-2 bg-gray-700/50 px-3 py-2 rounded",children:n.userEmail}),e.jsxs("p",{className:"text-amber-400 text-xs mt-3 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"L'utente dovrÃ  rifare l'onboarding per generare un nuovo programma."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m({isOpen:!1,userId:"",userEmail:"",isResetting:!1}),disabled:n.isResetting,className:"flex-1 px-4 py-3 bg-gray-700 text-white rounded-lg font-medium hover:bg-gray-600 transition disabled:opacity-50",children:"Annulla"}),e.jsx("button",{onClick:()=>S(n.userId),disabled:n.isResetting,className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition disabled:opacity-50 flex items-center justify-center gap-2",children:n.isResetting?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),"Resettando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Conferma Reset"]})})]})]})})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-400",children:"Nessun dato disponibile"})})})}function h({title:d,value:c,subtitle:i,icon:g,color:b}){const t={blue:"from-blue-600 to-blue-800",green:"from-green-600 to-green-800",purple:"from-purple-600 to-purple-800",orange:"from-orange-600 to-orange-800"};return e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:`bg-gradient-to-br ${t[b]} rounded-xl p-6 shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-4xl",children:g}),e.jsx("span",{className:"text-white/80 text-sm",children:d})]}),e.jsx("div",{className:"text-3xl font-bold",children:c.toLocaleString()}),i&&e.jsx("div",{className:"text-white/60 text-sm mt-1",children:i})]})}function p({title:d,rate:c}){const i=isNaN(c)?0:c,g=i>=50?"text-green-400":i>=20?"text-yellow-400":"text-red-400";return e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-gray-400 text-xs mb-2",children:d}),e.jsxs("div",{className:`text-2xl font-bold ${g}`,children:[i.toFixed(1),"%"]})]})}export{Q as default};
