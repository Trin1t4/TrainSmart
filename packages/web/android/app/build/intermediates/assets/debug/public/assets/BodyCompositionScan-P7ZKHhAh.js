import{j as e}from"./vendor-ui-B5xs3EUI.js";import{u as v,a as n}from"./vendor-react-DLKD8xKB.js";import{s as u}from"./index-CsHuaFST.js";import"./vendor-supabase-DF1H9KNm.js";function S(){var p;const m=v(),[a,i]=n.useState({waistCm:"",neckCm:"",hipCm:""}),[d,c]=n.useState(!1),[l,g]=n.useState(null),[x,b]=n.useState(null),r=JSON.parse(localStorage.getItem("onboarding_data")||"{}"),o=((p=r.personalInfo)==null?void 0:p.gender)==="female",f=async()=>{c(!0),b(null);try{if(!a.waistCm||!a.neckCm)throw new Error("Inserisci almeno vita e collo");if(o&&!a.hipCm)throw new Error("Per le donne la misura fianchi Ã¨ obbligatoria");const s=await fetch("/api/body-composition-analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({height:r.personalInfo.height,weight:r.personalInfo.weight,age:r.personalInfo.age,gender:r.personalInfo.gender,waistCm:parseFloat(a.waistCm),neckCm:parseFloat(a.neckCm),hipCm:a.hipCm?parseFloat(a.hipCm):null})});if(!s.ok){const N=await s.json();throw new Error(N.error||"Errore nel calcolo")}const t=await s.json();g(t);const C={...r,bodyComposition:{bodyFatPercentage:t.bodyFatPercentage,fatMassKg:t.fatMassKg,leanMassKg:t.leanMassKg,bodyShape:t.bodyShape,healthRisk:t.healthRisk,method:"us_navy_formula",measurements:{waistCm:parseFloat(a.waistCm),neckCm:parseFloat(a.neckCm),hipCm:a.hipCm?parseFloat(a.hipCm):null},scanDate:new Date().toISOString()}};localStorage.setItem("onboarding_data",JSON.stringify(C));const{data:{user:h}}=await u.auth.getUser();h&&await u.from("body_scans").insert({user_id:h.id,body_fat_percentage:t.bodyFatPercentage,fat_mass_kg:t.fatMassKg,lean_mass_kg:t.leanMassKg,body_shape:t.bodyShape,health_risk:t.healthRisk,method:"us_navy_formula",scan_date:new Date().toISOString()})}catch(s){console.error("[BODY SCAN] Error:",s),b(s.message||"Errore nel calcolo")}finally{c(!1)}},j=()=>{m("/quiz")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"ðŸ“ Composizione Corporea"}),e.jsx("p",{className:"text-slate-300 mb-2",children:"Calcola il tuo body fat % con la formula US Navy (accuracy 96%)"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Serve solo un metro da sarta e 2-3 misure"})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/50 rounded-lg p-5 mb-6",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-300 mb-3",children:"ðŸ“ Come misurare correttamente:"}),e.jsxs("div",{className:"space-y-3 text-sm text-blue-200",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:"1."}),e.jsxs("div",{children:[e.jsx("strong",{children:"Circonferenza Vita:"})," punto piÃ¹ stretto dell'addome (all'altezza ombelico), a pancia rilassata, metro orizzontale"]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:"2."}),e.jsxs("div",{children:[e.jsx("strong",{children:"Circonferenza Collo:"})," sotto il pomo d'Adamo, testa dritta, metro orizzontale senza stringere"]})]}),o&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-400 font-bold mt-0.5",children:"3."}),e.jsxs("div",{children:[e.jsx("strong",{children:"Circonferenza Fianchi:"})," punto piÃ¹ largo dei glutei, piedi uniti, metro orizzontale"]})]})]})]}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-700 mb-6",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Circonferenza Vita (cm) *"}),e.jsx("input",{type:"number",step:"0.5",value:a.waistCm,onChange:s=>i({...a,waistCm:s.target.value}),placeholder:"es. 85",className:"w-full bg-slate-700 border-2 border-slate-600 text-white rounded-lg px-4 py-3 text-lg focus:border-emerald-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Circonferenza Collo (cm) *"}),e.jsx("input",{type:"number",step:"0.5",value:a.neckCm,onChange:s=>i({...a,neckCm:s.target.value}),placeholder:"es. 38",className:"w-full bg-slate-700 border-2 border-slate-600 text-white rounded-lg px-4 py-3 text-lg focus:border-emerald-500 focus:outline-none"})]}),o&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Circonferenza Fianchi (cm) *"}),e.jsx("input",{type:"number",step:"0.5",value:a.hipCm,onChange:s=>i({...a,hipCm:s.target.value}),placeholder:"es. 95",className:"w-full bg-slate-700 border-2 border-slate-600 text-white rounded-lg px-4 py-3 text-lg focus:border-emerald-500 focus:outline-none"})]})]})}),x&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/50 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-red-300",children:["âš ï¸ ",x]})}),l&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-6 border border-slate-700 mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"ðŸ“Š Risultati Analisi"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-emerald-500/20 rounded-lg p-4 border border-emerald-500/50",children:[e.jsx("p",{className:"text-xs text-emerald-300 mb-1",children:"Body Fat %"}),e.jsxs("p",{className:"text-3xl font-bold text-white",children:[l.bodyFatPercentage,"%"]})]}),e.jsxs("div",{className:"bg-blue-500/20 rounded-lg p-4 border border-blue-500/50",children:[e.jsx("p",{className:"text-xs text-blue-300 mb-1",children:"Massa Magra"}),e.jsxs("p",{className:"text-3xl font-bold text-white",children:[l.leanMassKg,"kg"]})]}),e.jsxs("div",{className:"bg-purple-500/20 rounded-lg p-4 border border-purple-500/50",children:[e.jsx("p",{className:"text-xs text-purple-300 mb-1",children:"Massa Grassa"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[l.fatMassKg,"kg"]})]}),e.jsxs("div",{className:"bg-amber-500/20 rounded-lg p-4 border border-amber-500/50",children:[e.jsx("p",{className:"text-xs text-amber-300 mb-1",children:"Forma Corporea"}),e.jsx("p",{className:"text-lg font-bold text-white capitalize",children:l.bodyShape.replace("_"," ")})]})]}),e.jsxs("div",{className:"bg-slate-700/30 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"â„¹ï¸ Formula US Navy - Accuracy 96% vs DXA"}),e.jsx("p",{className:"text-xs text-slate-300",children:"Questi dati verranno usati per calcolare il tuo livello fitness (30% del punteggio totale) e personalizzare il programma di allenamento."})]}),e.jsx("button",{onClick:()=>m("/quiz"),className:"w-full bg-gradient-to-r from-emerald-500 to-emerald-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:from-emerald-600 hover:to-emerald-700 transition",children:"Continua con il Quiz â†’"})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f,disabled:!a.waistCm||!a.neckCm||o&&!a.hipCm||d,className:"w-full bg-gradient-to-r from-emerald-500 to-emerald-600 text-white py-4 rounded-xl font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/20 hover:from-emerald-600 hover:to-emerald-700 transition mb-3",children:d?"Calcolo in corso...":"Calcola Body Fat %"}),e.jsx("button",{onClick:j,disabled:d,className:"w-full bg-slate-700 text-slate-300 py-3 rounded-lg font-semibold hover:bg-slate-600 transition",children:"Salta (usa solo BMI) â†’"})]})]})})}export{S as default};
