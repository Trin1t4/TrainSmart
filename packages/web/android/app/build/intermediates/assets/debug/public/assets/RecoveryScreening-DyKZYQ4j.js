import{j as e,G,X as V,D as B,P as H,C as T}from"./vendor-ui-B5xs3EUI.js";import{a as c}from"./vendor-react-DLKD8xKB.js";import{u as J,s as N}from"./index-CsHuaFST.js";import"./vendor-supabase-DF1H9KNm.js";const D={leg_press:{name:"Squat con Bilanciere",description:"Lo squat attiva piu muscoli: core, stabilizzatori, glutei. E il re degli esercizi per le gambe.",videoUrl:"/videos/exercises/back-squat.mp4",benefits:"Maggiore attivazione muscolare globale, forza funzionale"},"Leg Press":{name:"Squat con Bilanciere",description:"Lo squat attiva piu muscoli: core, stabilizzatori, glutei. E il re degli esercizi per le gambe.",videoUrl:"/videos/exercises/back-squat.mp4",benefits:"Maggiore attivazione muscolare globale, forza funzionale"},chest_press:{name:"Panca Piana",description:"La panca piana attiva stabilizzatori e core. Movimento piu naturale e completo.",videoUrl:"/videos/exercises/flat-barbell-bench-press.mp4",benefits:"Stabilizzazione attiva, maggiore ROM"},"Chest Press":{name:"Panca Piana",description:"La panca piana attiva stabilizzatori e core. Movimento piu naturale e completo.",videoUrl:"/videos/exercises/flat-barbell-bench-press.mp4",benefits:"Stabilizzazione attiva, maggiore ROM"},shoulder_press_machine:{name:"Military Press",description:"Il military press in piedi attiva tutto il core e insegna la stabilita verticale.",videoUrl:"/videos/exercises/military-press.mp4",benefits:"Core engagement, equilibrio, forza funzionale"},"Shoulder Press Machine":{name:"Military Press",description:"Il military press in piedi attiva tutto il core e insegna la stabilita verticale.",videoUrl:"/videos/exercises/military-press.mp4",benefits:"Core engagement, equilibrio, forza funzionale"},row_machine:{name:"Pulley Basso",description:"Il pulley basso richiede controllo del tronco e attiva la catena posteriore.",videoUrl:"/videos/exercises/seated-cable-row.mp4",benefits:"Controllo posturale, attivazione core"},"Row Machine":{name:"Pulley Basso o Rematore con Bilanciere",description:"Esercizi a cavi o bilanciere richiedono piu controllo e attivano la catena posteriore.",videoUrl:"/videos/exercises/barbell-row.mp4",benefits:"Controllo posturale, attivazione core"},leg_curl:{name:"Romanian Deadlift",description:"Lo stacco rumeno allena i femorali in modo funzionale, migliorando anche la postura.",videoUrl:"/videos/exercises/romanian-deadlift.mp4",benefits:"Pattern di movimento funzionale, catena posteriore"},"Leg Curl":{name:"Romanian Deadlift",description:"Lo stacco rumeno allena i femorali in modo funzionale, migliorando anche la postura.",videoUrl:"/videos/exercises/romanian-deadlift.mp4",benefits:"Pattern di movimento funzionale, catena posteriore"},leg_extension:{name:"Bulgarian Split Squat",description:"Allena i quadricipiti unilateralmente, migliorando equilibrio e stabilita.",videoUrl:"/videos/exercises/bulgarian-split-squat.mp4",benefits:"Equilibrio, correzione asimmetrie, stabilita"},"Leg Extension":{name:"Bulgarian Split Squat",description:"Allena i quadricipiti unilateralmente, migliorando equilibrio e stabilita.",videoUrl:"/videos/exercises/bulgarian-split-squat.mp4",benefits:"Equilibrio, correzione asimmetrie, stabilita"}};function K(r){return r.sleepHours<6.5?{optimal:!1,reason:"Sonno insufficiente - meglio restare sulla routine abituale"}:r.stressLevel>5?{optimal:!1,reason:"Livello di stress elevato - non e il momento per nuove sfide"}:r.hasInjury?{optimal:!1,reason:"Presenza di dolore/infortunio - priorita al recupero"}:r.menstrualCycle==="menstruation"?{optimal:!1,reason:"Fase mestruale - meglio non introdurre nuovi movimenti"}:{optimal:!0}}function Y(){var r;try{const i=localStorage.getItem("screening_data"),n=localStorage.getItem("onboarding_data");if(!i)return{usedOnlyMachines:!1};const a=JSON.parse(i);let t;return n&&(t=(r=JSON.parse(n).personalInfo)==null?void 0:r.age),{usedOnlyMachines:a.usedOnlyMachines===!0,age:t}}catch(i){return console.error("[FreeWeightSuggestion] Error reading user preference:",i),{usedOnlyMachines:!1}}}function Q(r){var i;if(!r||r.length===0)return null;for(const n of r){const a=n.id||((i=n.name)==null?void 0:i.toLowerCase().replace(/\s+/g,"_")),t=n.name,o=D[a]||D[t];if(o)return{machineExercise:t||a,alternative:o}}return null}function X(r,i){const{usedOnlyMachines:n,age:a}=Y();if(!n)return{shouldSuggest:!1,machineExercise:"",freeWeightAlternative:"",freeWeightDescription:"",reason:"Utente usa gia pesi liberi"};if(a&&a>50)return{shouldSuggest:!1,machineExercise:"",freeWeightAlternative:"",freeWeightDescription:"",reason:"Proposta riservata a utenti sotto i 50 anni"};const t=K(r);if(!t.optimal)return{shouldSuggest:!1,machineExercise:"",freeWeightAlternative:"",freeWeightDescription:"",reason:t.reason};const o=Q(i);if(!o)return{shouldSuggest:!1,machineExercise:"",freeWeightAlternative:"",freeWeightDescription:"",reason:"Nessun esercizio macchina con alternativa nel workout di oggi"};const p=localStorage.getItem("last_freeweight_suggestion");if(p){const l=(Date.now()-parseInt(p))/864e5;if(l<7)return{shouldSuggest:!1,machineExercise:"",freeWeightAlternative:"",freeWeightDescription:"",reason:`Proposta gia mostrata ${Math.floor(l)} giorni fa - aspetta 7 giorni`}}return{shouldSuggest:!0,machineExercise:o.machineExercise,freeWeightAlternative:o.alternative.name,freeWeightDescription:o.alternative.description,videoUrl:o.alternative.videoUrl}}function M(){localStorage.setItem("last_freeweight_suggestion",Date.now().toString())}function W(r,i){const n="freeweight_suggestion_history",a=JSON.parse(localStorage.getItem(n)||"[]");a.push({timestamp:new Date().toISOString(),exercise:i,accepted:r}),a.length>20&&a.shift(),localStorage.setItem(n,JSON.stringify(a)),r&&a.filter(o=>o.accepted).length>=3&&console.log("[FreeWeightSuggestion] User has accepted 3+ times - consider updating their preference")}function Z({machineExercise:r,freeWeightAlternative:i,freeWeightDescription:n,videoUrl:a,onAccept:t,onDecline:o}){const[d,p]=c.useState(!1),l=()=>{M(),W(!0,i),t()},b=()=>{M(),W(!1,i),o()};return e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-2xl p-5 shadow-lg animate-in slide-in-from-top duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/30",children:e.jsx(G,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:"Prova qualcosa di nuovo!"}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Oggi sei in forma perfetta"})]})]}),e.jsx("button",{onClick:b,className:"p-1.5 rounded-lg hover:bg-gray-200 text-gray-400 hover:text-gray-600 transition",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-white/80 rounded-xl p-4 mb-4 border border-blue-200",children:[e.jsxs("p",{className:"text-gray-700 mb-3",children:["Visto che oggi usi ",e.jsx("span",{className:"font-semibold text-gray-900",children:r}),", perche non provi:"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-white"})}),e.jsx("div",{children:e.jsx("p",{className:"font-bold text-blue-700 text-lg",children:i})})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:n}),a&&e.jsx("div",{className:"mt-4",children:d?e.jsx("div",{className:"relative rounded-lg overflow-hidden bg-black aspect-video",children:e.jsx("video",{src:a,className:"w-full h-full object-contain",controls:!0,autoPlay:!0,loop:!0,muted:!0,playsInline:!0})}):e.jsxs("button",{onClick:()=>p(!0),className:"w-full flex items-center justify-center gap-2 py-3 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition font-medium",children:[e.jsx(H,{className:"w-4 h-4 fill-current"}),"Guarda come si esegue"]})})]}),e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-emerald-700 text-sm font-medium",children:"Inizierai con peso leggero per imparare la tecnica. Poi alternerai tra macchina e peso libero."})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:b,className:"flex-1 py-3 px-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold transition",children:"No, resto sulla macchina"}),e.jsxs("button",{onClick:l,className:"flex-1 py-3 px-4 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-blue-500/30 transition flex items-center justify-center gap-2",children:["Si, proviamo!",e.jsx(T,{className:"w-5 h-5"})]})]})]})}const re=({onComplete:r,onSkip:i,workoutExercises:n=[]})=>{const{t:a}=J(),[t,o]=c.useState(7),[d,p]=c.useState(5),[l,b]=c.useState(!1),[y,z]=c.useState(""),[m,w]=c.useState(null),[g,k]=c.useState(!1),[C,_]=c.useState(!1),[h,A]=c.useState(45),[x,I]=c.useState(null),[v,q]=c.useState(null),[U,j]=c.useState(!1);c.useEffect(()=>{O()},[]),c.useEffect(()=>{if(n.length>0){const s=X({sleepHours:t,stressLevel:d,hasInjury:l,menstrualCycle:m||void 0},n);s.shouldSuggest?(I(s),t>=6.5&&d<=5&&!l&&j(!0)):(I(null),j(!1))}},[t,d,l,m,n]);const O=async()=>{var s,u;try{localStorage.getItem("menstrual_preference")==="menopause"&&(console.log("[RECOVERY] ‚úÖ User has menopause preference saved - hiding menstrual section"),_(!0),w("menopause"));const{data:P}=await N.auth.getUser();if(P.user){const{data:S}=await N.from("user_profiles").select("onboarding_data").eq("user_id",P.user.id).single();((u=(s=S==null?void 0:S.onboarding_data)==null?void 0:s.personalInfo)==null?void 0:u.gender)==="F"&&k(!0)}}catch(E){console.error("Error fetching user gender:",E)}},f=s=>{w(s),s==="menopause"&&(localStorage.setItem("menstrual_preference","menopause"),console.log("[RECOVERY] üíæ Saved menopause preference - will not ask again"),_(!0))},F=()=>{const s=[];if(h<=20?s.push("‚ö° Allenamento Express - solo esercizi principali"):h<=30?s.push("üèÉ Allenamento Veloce - riduzione pause e accessori"):h>=75&&s.push("üèãÔ∏è Allenamento Completo - tutti gli esercizi + accessori"),t<6){const u=t<5?30:20;s.push(`üîª Volume ridotto del ${u}% per sonno insufficiente`)}return d>=8?s.push("üîª Intensit√† ridotta del 20% per stress elevato"):d>=6&&s.push("‚ö†Ô∏è Intensit√† ridotta del 10% per stress moderato"),l&&y&&s.push("ü©π Esercizi modificati per evitare zone doloranti"),g&&m==="menstruation"&&s.push("üî¥ Intensit√† ottimizzata per fase mestruale"),g&&m==="menopause"&&s.push("üßò‚Äç‚ôÄÔ∏è Programma ottimizzato per menopausa (focus resistenza)"),s.length===0?["‚úÖ Nessun adattamento necessario - Allenamento standard"]:s},L=async()=>{const s={sleepHours:t,stressLevel:d,hasInjury:l,injuryDetails:l?y:null,menstrualCycle:g?m:null,isFemale:g,availableTime:h,timestamp:new Date().toISOString(),tryFreeWeight:v,replaceMachine:v&&x?x.machineExercise:null};try{const{data:u}=await N.auth.getUser();u.user&&await N.from("recovery_tracking").insert({user_id:u.user.id,sleep_hours:t,stress_level:d,has_injury:l,injury_details:l?y:null,menstrual_cycle:g?m:null,is_female:g,available_time:h,created_at:new Date().toISOString()})}catch(u){console.error("Error saving recovery data:",u)}r(s)},R=F(),$=t<6||d>=6||l;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 my-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:a("screening.title")}),e.jsx("p",{className:"text-gray-600",children:a("screening.subtitle")})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block",children:e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"‚è±Ô∏è Quanto tempo hai oggi?"})}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:[{min:20,label:"20 min",icon:"‚ö°",desc:"Express"},{min:30,label:"30 min",icon:"üèÉ",desc:"Veloce"},{min:45,label:"45 min",icon:"üí™",desc:"Standard"},{min:60,label:"60 min",icon:"üî•",desc:"Completo"},{min:90,label:"90+ min",icon:"üèãÔ∏è",desc:"Lungo"}].map(s=>e.jsxs("button",{onClick:()=>A(s.min),className:`p-3 border-2 rounded-xl text-center transition-all ${h===s.min?"bg-emerald-100 border-emerald-500 text-emerald-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"text-xl",children:s.icon}),e.jsx("div",{className:"font-bold text-sm",children:s.label}),e.jsx("div",{className:"text-xs text-gray-500",children:s.desc})]},s.min))})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"block",children:[e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["üí§ ",a("screening.sleep")]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"12",step:"0.5",value:t,onChange:s=>o(parseFloat(s.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("span",{className:"text-3xl font-bold text-emerald-600 w-16 text-center",children:[t,"h"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[t<6&&e.jsxs("span",{className:"text-red-600 font-medium",children:["‚ö†Ô∏è ",a("screening.sleep_insufficient")]}),t>=6&&t<=9&&e.jsxs("span",{className:"text-emerald-600 font-medium",children:["‚úÖ ",a("screening.sleep_optimal")]}),t>9&&e.jsxs("span",{className:"text-amber-600 font-medium",children:["‚ö†Ô∏è ",a("screening.sleep_excessive")]})]})]})}),e.jsx("div",{className:"space-y-3",children:e.jsxs("label",{className:"block",children:[e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["üò∞ ",a("screening.stress")]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"10",value:d,onChange:s=>p(parseInt(s.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsx("span",{className:"text-3xl font-bold text-emerald-600 w-16 text-center",children:d})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"1 = Completamente rilassato | 10 = Stress massimo"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block",children:e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["ü©π ",a("screening.pain_question")]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{b(!1),z("")},className:`flex-1 p-4 border-2 rounded-xl font-semibold transition-all ${l?"border-gray-300 text-gray-600 hover:bg-gray-50":"bg-emerald-100 border-emerald-500 text-emerald-900"}`,children:["‚úÖ ",a("screening.no_pain")]}),e.jsxs("button",{onClick:()=>b(!0),className:`flex-1 p-4 border-2 rounded-xl font-semibold transition-all ${l?"bg-red-100 border-red-500 text-red-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["ü©π ",a("screening.have_pain")]})]}),l&&e.jsx("textarea",{value:y,onChange:s=>z(s.target.value),placeholder:"Descrivi dove hai dolore (es. spalla destra, ginocchio sinistro, lombare...)",className:"w-full p-4 border-2 border-gray-300 rounded-xl text-sm focus:outline-none focus:border-emerald-500",rows:3})]}),g&&!C&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"ü©∏ Fase del ciclo mestruale"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Se scegli "Menopausa", non ti chiederemo pi√π questa domanda'})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>f("menstruation"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="menstruation"?"bg-red-100 border-red-500 text-red-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üî¥ Mestruazione",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Giorni 1-5)"})]}),e.jsxs("button",{onClick:()=>f("follicular"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="follicular"?"bg-emerald-100 border-emerald-500 text-emerald-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üü¢ Follicolare",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Giorni 6-12)"})]}),e.jsxs("button",{onClick:()=>f("ovulation"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="ovulation"?"bg-amber-100 border-amber-500 text-amber-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üü° Ovulazione",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Giorni 13-15)"})]}),e.jsxs("button",{onClick:()=>f("luteal"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="luteal"?"bg-orange-100 border-orange-500 text-orange-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üü† Luteale",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Giorni 16-28)"})]}),e.jsxs("button",{onClick:()=>f("menopause"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="menopause"?"bg-purple-100 border-purple-500 text-purple-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üßò‚Äç‚ôÄÔ∏è Menopausa",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Non chieder√≤ pi√π)"})]}),e.jsxs("button",{onClick:()=>f("prefer_not_say"),className:`p-4 border-2 rounded-xl font-semibold text-sm transition-all ${m==="prefer_not_say"?"bg-gray-100 border-gray-500 text-gray-900":"border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:["üôÖ‚Äç‚ôÄÔ∏è Preferisco non rispondere",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal",children:"(Chieder√≤ ogni volta)"})]})]})]}),g&&C&&e.jsx("div",{className:"p-4 bg-purple-50 border-2 border-purple-300 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üßò‚Äç‚ôÄÔ∏è"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900",children:"Programma ottimizzato per menopausa"}),e.jsx("p",{className:"text-xs text-purple-700 mt-0.5",children:"Focus su resistenza, densit√† ossea e recupero. Preferenza salvata."})]})]})}),U&&x&&!v&&e.jsx(Z,{machineExercise:x.machineExercise,freeWeightAlternative:x.freeWeightAlternative,freeWeightDescription:x.freeWeightDescription,videoUrl:x.videoUrl,onAccept:()=>{q(x.freeWeightAlternative),j(!1)},onDecline:()=>{j(!1)}}),v&&e.jsx("div",{className:"p-4 bg-blue-50 border-2 border-blue-300 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üí™"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-blue-900",children:["Oggi provi: ",v]}),e.jsx("p",{className:"text-xs text-blue-700 mt-0.5",children:"Inizierai con peso leggero per imparare la tecnica"})]})]})}),e.jsxs("div",{className:`p-5 rounded-xl border-2 ${$?"bg-amber-50 border-amber-300":"bg-emerald-50 border-emerald-300"}`,children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-gray-900",children:"üéØ AdaptFlow - Adattamenti per oggi"}),e.jsx("div",{className:"space-y-2",children:R.map((s,u)=>e.jsx("div",{className:"flex items-start gap-2 text-sm",children:e.jsx("span",{className:"text-gray-900 font-medium",children:s})},u))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[i&&e.jsx("button",{onClick:i,className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-4 rounded-xl font-semibold transition-colors",children:"Salta"}),e.jsxs("button",{onClick:L,className:"flex-1 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-emerald-500/30 transition-all",children:["üöÄ ",a("screening.start_workout")]})]})]})]})})};export{re as RecoveryScreening};
